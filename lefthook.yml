# lefthook.yml
# Configuracao de git hooks para o projeto Skyller
# https://lefthook.dev/configuration/

pre-commit:
  parallel: true
  jobs:
    - name: biome-check
      glob: "*.{js,ts,jsx,tsx,json}"
      run: pnpm biome check --apply {staged_files}

    - name: typescript
      glob: "*.{ts,tsx}"
      run: pnpm tsc --noEmit

pre-push:
  parallel: true
  jobs:
    - name: tests
      run: pnpm vitest run --passWithNoTests

commit-msg:
  jobs:
    - name: commitlint
      run: |
        # Validacao basica de mensagem de commit
        # Formato esperado: tipo(escopo): descricao
        # Exemplo: feat(auth): adicionar login com Keycloak
        MSG=$(cat "$1")
        if ! echo "$MSG" | grep -qE "^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .+"; then
          echo "Erro: Mensagem de commit invalida."
          echo "Formato esperado: tipo(escopo): descricao"
          echo "Tipos validos: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert"
          exit 1
        fi
